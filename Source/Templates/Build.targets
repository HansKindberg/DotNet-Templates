<Project>
	<Target Name="PopulateTemplates">
		<Message Importance="high" Text="Populate templates..." />
		<ItemGroup>
			<!-- https://gist.github.com/robatwilliams/6512233 -->
			<Template Include="$([System.IO.Directory]::GetDirectories('Content'))" />
		</ItemGroup>
	</Target>
	<Target Name="Prepare" DependsOnTargets="PopulateTemplates">
		<Message Importance="high" Text="Prepare..." />

		<Copy DestinationFolder="%(Template.Identity)" SourceFiles="Common/.editorconfig;Common/.gitignore;Common/NuGet.config;Common/ReadMe.md" />
		<Copy Condition="$([System.String]::Copy('%(Template.Filename)').EndsWith('-Large'))" DestinationFolder="%(Template.Identity)" SourceFiles="Common/Directory.Build.targets;Common/$([System.String]::Copy('%(Template.Filename)').Replace('-Large', ''))/Build.yml;Common/$([System.String]::Copy('%(Template.Filename)').Replace('-Large', ''))/Deploy.yml;Common/$([System.String]::Copy('%(Template.Filename)').Replace('-Large', ''))/Pipeline.yml;Common/$([System.String]::Copy('%(Template.Filename)').Replace('-Large', ''))/Variables.yml" />

		<Copy Condition="$([System.String]::Copy('%(Template.Filename)').EndsWith('-Large')) AND $([System.String]::Copy('%(Template.Filename)').StartsWith('NuGet-Package'))" DestinationFolder="%(Template.Identity)" SourceFiles="Common/NuGet-Package/Directory.Build.props" />
		<Copy Condition="$([System.String]::Copy('%(Template.Filename)').EndsWith('-Large')) AND !$([System.String]::Copy('%(Template.Filename)').StartsWith('NuGet-Package'))" DestinationFolder="%(Template.Identity)" SourceFiles="Common/Directory.Build.props" />
		<Copy Condition="$([System.String]::Copy('%(Template.Filename)').StartsWith('NuGet-Package'))" DestinationFolder="%(Template.Identity)/Source/Project" SourceFiles="Common/NuGet-Package/Source/Project/ReadMe.md" />

















		<!--
		<Message Condition="$([System.String]::Copy('%(Template.Identity)').EndsWith('-Large'))" Importance="high" Text="Prepare LARGE: %(Template.Identity)" />
		<Message Condition="$([System.String]::Copy('%(Template.Identity)').EndsWith('-Medium'))" Importance="high" Text="Prepare MEDIUM: %(Template.Identity)" />
		-->

		<!--
		<Message Importance="high" Text="Prepare: %(AspNetRazorProject.Identity)" />
		<Copy DestinationFolder="%(AspNetRazorProject.Identity)" SourceFiles="Common/.editorconfig;Common/.gitignore;Common/NuGet.config;Common/ReadMe.md" />
		<Copy DestinationFolder="%(AspNetRazorProject.Identity)/Source/Project" SourceFiles="Common/NuGet-Package/Source/Project/ReadMe.md" />
		<Copy Condition="%(AspNetRazorProject.DirectoryBuild)" DestinationFolder="%(AspNetRazorProject.Identity)" SourceFiles="Common/NuGet-Package/Directory.Build.props;Common/Directory.Build.targets" />
		<Copy Condition="%(AspNetRazorProject.DirectoryBuild)" DestinationFolder="%(AspNetRazorProject.Identity)/Source/Project" SourceFiles="Common/NuGet-Package/Source/Project/Project.csproj" />
		<Copy Condition="%(AspNetRazorProject.Pipeline)" DestinationFolder="%(AspNetRazorProject.Identity)" SourceFiles="Common/NuGet-Package/Build.yml;Common/NuGet-Package/Deploy.yml;Common/NuGet-Package/Pipeline.yml;Common/NuGet-Package/Variables.yml" />
		-->
	</Target>
	<Target Name="Transform" BeforeTargets="Build" DependsOnTargets="Prepare">
		<Message Importance="high" Text="Transform..." />
		<!--
			<Message Importance="high" Text="Transform: %(Template.Identity) - %(Template.Filename) - %(Template.Directory) - %(Template.RootDir)" />
		-->
		<!--<Message Importance="high" Text="Transform: %(NuGetPackageProject.Identity)" />-->
		<TransformTask Destination="%(Template.Identity)/.template.config/template.json" Source="Common/.template.config/Solution.Template.json" Transform="%(Template.Identity)/.template.config/Transform.Template.json" />
	</Target>
</Project>